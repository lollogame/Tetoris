'use strict';

/* =========================================================
   Constants
========================================================= */
const COLS = 10;
const ROWS = 20;
const SPAWN_ROW = -2;
const BLOCK_SIZE = 32;
const PREVIEW_BLOCK_SIZE = 16;

const ROTATION_BUFFER_MS = 120;
const HOLD_IRS_BUFFER_MS = 120;

const STATE_SEND_INTERVAL = 50;
const ROTATION_STATES = ['0', 'R', '2', 'L'];

const GARBAGE_APPLY_CAP = 8; // tweak: 8, 12, 16

const BUILD_TAG = 'holdfix-20260210-10-fullscript';
console.log('BUILD', BUILD_TAG);

/* =========================================================
   SRS Kick Tables
========================================================= */
const KICK_TABLE = {
  'JLSTZ': {
    '0->R': [[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],
    'R->0': [[0,0],[1,0],[1,-1],[0,2],[1,2]],
    'R->2': [[0,0],[1,0],[1,-1],[0,2],[1,2]],
    '2->R': [[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],
    '2->L': [[0,0],[1,0],[1,1],[0,-2],[1,-2]],
    'L->2': [[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],
    'L->0': [[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],
    '0->L': [[0,0],[1,0],[1,1],[0,-2],[1,-2]]
  },
  'I': {
    '0->R': [[0,0],[-2,0],[1,0],[-2,-1],[1,2]],
    'R->0': [[0,0],[2,0],[-1,0],[2,1],[-1,-2]],
    'R->2': [[0,0],[-1,0],[2,0],[-1,2],[2,-1]],
    '2->R': [[0,0],[1,0],[-2,0],[1,-2],[-2,1]],
    '2->L': [[0,0],[2,0],[-1,0],[2,1],[-1,-2]],
    'L->2': [[0,0],[-2,0],[1,0],[-2,-1],[1,2]],
    'L->0': [[0,0],[1,0],[-2,0],[1,-2],[-2,1]],
    '0->L': [[0,0],[-1,0],[2,0],[-1,2],[2,-1]]
  },
  'O': {
    '0->R': [[0,0]], 'R->0': [[0,0]], 'R->2': [[0,0]], '2->R': [[0,0]],
    '2->L': [[0,0]], 'L->2': [[0,0]], 'L->0': [[0,0]], '0->L': [[0,0]]
  }
};

/* =========================================================
   Tetromino Shapes
========================================================= */
const SHAPES = {
  'I': { shape: [
    [[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],
    [[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],
    [[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],
    [[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]
  ], color:'#00f0f0' },
  'O': { shape: [
    [[1,1],[1,1]], [[1,1],[1,1]], [[1,1],[1,1]], [[1,1],[1,1]]
  ], color:'#f0f000' },
  'T': { shape: [
    [[0,1,0],[1,1,1],[0,0,0]],
    [[0,1,0],[0,1,1],[0,1,0]],
    [[0,0,0],[1,1,1],[0,1,0]],
    [[0,1,0],[1,1,0],[0,1,0]]
  ], color:'#a000f0' },
  'S': { shape: [
    [[0,1,1],[1,1,0],[0,0,0]],
    [[0,1,0],[0,1,1],[0,0,1]],
    [[0,0,0],[0,1,1],[1,1,0]],
    [[1,0,0],[1,1,0],[0,1,0]]
  ], color:'#00f000' },
  'Z': { shape: [
    [[1,1,0],[0,1,1],[0,0,0]],
    [[0,0,1],[0,1,1],[0,1,0]],
    [[0,0,0],[1,1,0],[0,1,1]],
    [[0,1,0],[1,1,0],[1,0,0]]
  ], color:'#f00000' },
  'J': { shape: [
    [[1,0,0],[1,1,1],[0,0,0]],
    [[0,1,1],[0,1,0],[0,1,0]],
    [[0,0,0],[1,1,1],[0,0,1]],
    [[0,1,0],[0,1,0],[1,1,0]]
  ], color:'#0000f0' },
  'L': { shape: [
    [[0,0,1],[1,1,1],[0,0,0]],
    [[0,1,0],[0,1,0],[0,1,1]],
    [[0,0,0],[1,1,1],[1,0,0]],
    [[1,1,0],[0,1,0],[0,1,0]]
  ], color:'#f0a000' }
};

const SPAWN_COLUMNS = { 'O':4,'T':3,'Z':3,'I':3,'L':3,'J':3,'S':3 };
